# ========================================
#   CLUSTER & DEPLOIEMENT
# ========================================
spark.master                        spark://vmhadoopmaster.srv.lamsade.dauphine.fr:7077
spark.app.config                    /opt/cephfs/users/students/p6emiasd2025/aduvignac-rosa/workspace/flight/conf/application.conf
spark.local.dir                     /opt/cephfs/users/students/p6emiasd2025/aduvignac-rosa/workspace/flight/spark-local

# ========================================
#   DRIVER
# ========================================
spark.driver.memory                 8g
spark.driver.extraJavaOptions       -Dfile.encoding=UTF-8 -Dlog4j.configuration=/opt/cephfs/users/students/p6emiasd2025/aduvignac-rosa/workspace/flight/conf/log4j2.properties

# ========================================
#   EXECUTORS
# ========================================
spark.executor.instances            18
spark.executor.cores                4
spark.executor.memory               6g
spark.executor.memoryOverhead       2048
spark.executor.extraJavaOptions     -Dfile.encoding=UTF-8 -Dlog4j.configuration=/opt/cephfs/users/students/p6emiasd2025/aduvignac-rosa/workspace/flight/conf/log4j2.properties

# ========================================
#   SERIALIZATION
# ========================================
spark.serializer                    org.apache.spark.serializer.KryoSerializer
spark.kryoserializer.buffer         64m
spark.kryoserializer.buffer.max     1024m

# ========================================
#   NETWORK & HEARTBEAT
# ========================================
spark.network.timeout               600s
spark.executor.heartbeatInterval    30s

# ========================================
#   ADAPTIVE QUERY EXECUTION (AQE)
# ========================================
spark.sql.adaptive.enabled                           true
spark.sql.adaptive.coalescePartitions.enabled        true
spark.sql.adaptive.localShuffleReader.enabled        true
spark.sql.adaptive.advisoryPartitionSizeInBytes      128MB
spark.sql.adaptive.skewJoin.enabled                  true
spark.sql.adaptive.skewJoin.skewedPartitionFactor    2
spark.sql.adaptive.skewJoin.skewedPartitionThresholdInBytes 16MB

# ========================================
#   SHUFFLE & PARALLÃ‰LISME
# ========================================
spark.sql.shuffle.partitions         640
spark.default.parallelism            640
spark.shuffle.compress               true
spark.shuffle.spill.compress         true

# ========================================
#   GOLD PARAMS (custom)
# ========================================
spark.flight.gold.single.shuffle           true
spark.flight.gold.single.coalesce          640
spark.flight.gold.partitions               640
spark.flight.gold.saltBuckets              96

# ========================================
#   I/O & FORMAT
# ========================================
spark.sql.files.maxRecordsPerFile    500000
spark.sql.files.maxPartitionBytes    268435456
spark.sql.autoBroadcastJoinThreshold 10m
spark.sql.join.preferSortMergeJoin   true

# ========================================
#   CACHE IN-MEMORY
# ========================================
spark.sql.inMemoryColumnarStorage.compressed   true
spark.sql.inMemoryColumnarStorage.batchSize    20000
