<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Global ML Report</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
        }
        h1, h2 {
            margin-top: 40px;
        }
        .experiment-block {
            margin-bottom: 80px;
            padding-bottom: 40px;
            border-bottom: 2px solid #ddd;
        }
    </style>
</head>

<body>

<h1>ðŸ“Š Flight project Experiments Report</h1>
<p>Automatically generated by GitHub Actions.</p>

<hr>

<h2>ðŸ“‹ Summary Table</h2>
<table border="1" cellpadding="6" cellspacing="0">
    <tr>
        <th>Dataset</th>
        <th>Threshold</th>
        <th>Origin (h)</th>
        <th>Dest (h)</th>
        <th>AUC</th>
        <th>AUC PR</th>
        <th>Accuracy</th>
        <th>Recall</th>
        <th>Precision</th>
    </tr>

    {% for exp in experiments %}
    <tr>
        <td>{{ exp.ds }}</td>
        <td>{{ exp.th }}</td>
        <td>{{ exp.origin }}</td>
        <td>{{ exp.dest }}</td>
        <td>{{ "%.4f"|format(exp.metrics["auc"]) }}</td>
        <td>{{ "%.4f"|format(exp.metrics["prAuc"]) }}</td>
        <td>{{ "%.4f"|format(exp.metrics["accuracy"]) }}</td>
        <td>{{ "%.4f"|format(exp.metrics["recall"]) }}</td>
        <td>{{ "%.4f"|format(exp.metrics["precision"]) }}</td>
    </tr>
    {% endfor %}
</table>

<hr/>

{% for exp in experiments %}
<div class="experiment-block">
    <h2>ðŸ”Ž Experiment â€” {{ exp.title }}</h2>

    <h3>Feature Importances</h3>
    <div id="fi_plot_{{ loop.index }}"></div>

    <script>
        var fi_data = [{
            x: {{ exp.fi_names | tojson }},
            y: {{ exp.fi_values | tojson }},
            type: 'bar'
        }];

        var fi_layout = {
            title: "Feature Importances â€” {{ exp.title }}",
            xaxis: { tickangle: 45 }
        };

        Plotly.newPlot("fi_plot_{{ loop.index }}", fi_data, fi_layout);
    </script>

    {% if exp.roc_x %}
    <h3>ROC Curve</h3>
    <div id="roc_plot_{{ loop.index }}"></div>
    <script>
        Plotly.newPlot("roc_plot_{{ loop.index }}", [{
            x: {{ exp.roc_x | tojson }},
            y: {{ exp.roc_y | tojson }},
            mode: 'lines',
            line: {color: 'blue'}
        }], {
            title: "ROC Curve â€” {{ exp.title }}",
            xaxis: { title: "False Positive Rate" },
            yaxis: { title: "True Positive Rate" }
        });
    </script>
    {% endif %}

    {% if exp.pr_x %}
    <h3>Precision-Recall Curve</h3>
    <div id="pr_plot_{{ loop.index }}"></div>
    <script>
        Plotly.newPlot("pr_plot_{{ loop.index }}", [{
            x: {{ exp.pr_x | tojson }},
            y: {{ exp.pr_y | tojson }},
            mode: 'lines',
            line: {color: 'green'}
        }], {
            title: "PR Curve â€” {{ exp.title }}",
            xaxis: { title: "Recall" },
            yaxis: { title: "Precision" }
        });
    </script>
    {% endif %}

</div>
{% endfor %}

</body>
</html>